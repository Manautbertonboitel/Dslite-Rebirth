STATES

WAITING
    # état de base lorsqu'il ne se passe rien
    
    Charge ATB
    Time ON
    Trigger de la ACTION EXECUTE state

ACTION EXECUTE
    # Important pour n'avoir qu'une action qui s'exécute à la fois (ATTAQUE, OBJECT, HEAL, FUIR, etc.)
    
    DODGE WINDOW 
        Si une IA attaque un Joueur
            Si l'attaque possède une dodge window
                Une dodge window s'ouvre
                    Si le joueur à un fighter READY, il peut exécuter l'action ROLL pour dodge
                    Back to Action Execute
                    
    Side issues :
        - Si l'attaquant est mort il faut supprimer l'action de la queue, Si il est ressuscité il repasse par une state de charge d'ATB etc
        - Si la cible est morte il faut choisir une autre cible TODO en parler à Anthony
        

END STATE
    # Fin du combat, si victoire affichage des stats et back to le monde réel / si défaite game over load de la dernière sauvegarde  


ACTION SELECT
    
    Si la queue Fighter Ready n'est pas vide,
        tant que le premier fighter de la qeue Fighter Ready est en vie 
            le UI est disponible, peut sélectionner une attaque, une target, et submit une requête d'attaque à la Action Queue
    
    Side issues : 
        - OUI one peut select si on est en train de se faire attaquer, tant que notre perso est en vie. si le perso meurt toutes ses attaques queued doivent être supprimées

CHECK STATE

    Vérification des conditions de victoire / défaite
    Si fin du combat => ENDSTATE(Victory ou pas)

ATB Combat system :

Je veux :

- Chaque fighter à une jauge d'ATB
- La jauge se remplit avec le temps qui passe
- Quand la jauge est a 100% le fighter est placé dans une liste de fighters "actifs"

Si la liste des fighters actifs n'est pas vide :
    - Le premier fighter de cette liste peut :
        - Request une action
        - Si la liste de résolution d'action est vide OU qu'une dodge window est ouverte :
            - Effectuer instantanément une action "Roll"
    - Si il request une action :
        - L'action est placée dans une liste de résolution d'actions
    - Si il effectue une action "Roll"
        - Effectuer instantanément une action "Roll"
        - Signaler quand l'action est terminée
        
Si la liste de résolution d'action n'est pas vide :
    - On exécute la première action de la liste :
        - Reset l'ATB du caster
        - Exécution de l'action
            - si l'action est une attaque :
                - Ouverture de la dodge window
                - Si la cible utilise "Roll" pendant la dodge window :
                    - Fermeture de la dodge window
                    - Exécution instantanée de l'action "Roll"
                    - Signaler quand l'action est terminée
                - Sinon :
                    - Exécution de l'attaque
                    - Signaler quand l'action est terminée
    - Action terminée ?
        - On check les conditions de victoire
        - On retire l'action de la liste de résolution des actions
        - On retire le caster de la liste de fighters "actifs"
      
      
      
TODO Tenter de tout Diviser Combat Manager en 2 : Temps réel combat manager -> turn combat manager -> State Machine

TODO Observer pattern pour la UI


# --------------------------------------------------------------------
# ACTION COMMAND PATTERN
# --------------------------------------------------------------------

- Mes actions sont actuellement des ressources, ce qui permet d'avoir plein de ressources et de modifier les caractéristiques (pour faire des attaques différentes par exemple) :

une attack action :
- caster
- target
- power
- cost

une attaque AOE :
- caster
- array de targets ? team ?
- power
- cost

une action de fuite :
- caster
Mais c'est toute l'équipe qui tente de fuir, pas de target ni de cost

heal_action :
- caster
- target
- power
- cost

(target.hp += target.hp + power * caster.power)

heal_action_aoe :

- caster
- array de targets ? team ?
- power
- cost

item_action :
- item qui heal
- item qui boost des stats
- item qui lance un sort d'attaque particulier (caster + target)
- etc etc etc




